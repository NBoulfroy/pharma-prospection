/**
 * Form class.
 *
 * @Project : Pharma-Prospection
 * @File    : web/assets/js/Form.js
 * @Version : 1.0
 * @Author  : BOULFROY Nicolas
 * @Create  : 2018/03/15
 */

/**
 * Form class constructor.
 *
 * @param {string} id
 * @param {string} submitButton
 * @param {array} buttons
 * @constructor
 */
function Form(id, submitButton, buttons) {
    this.id = id;
    this.submitButton = submitButton;
    this.buttons = buttons;
    this.form = document.getElementById(this.id);
    this._events();
}

/**
 * Controls value by a type passed in parameters.
 *
 * @param {string} type
 * @param {int|string} value
 * @returns {boolean}
 * @private
 */
Form.prototype._controlValue = function(type, value) {
    switch(type) {
        case 'int':
            return /^[0-9]{1,}$/g.test(value);
        case 'decimal':
            return /^[0-9]+(\.[0-9][0-9]?)?$/g.test(value);
    }
};

/**
 * Controls the input.
 *
 * @returns {boolean}
 * @private
 */
Form.prototype._controlInput = function(type, value) {
    // Controls the value.
    if (!this._controlValue(type, value)) {
        // Disables the button.
        document.getElementById('save').setAttribute('disabled', 'disabled');
        return false;
    } else {
        // Enables the button.
        document.getElementById('save').removeAttribute('disabled');
        return true;
    }
};

/**
 * Controls the form.
 *
 * @private
 */
Form.prototype._controlForm = function() {
    let inputs = this.form.getElementsByTagName('input');

    let i;
    for (i = 0; i < inputs.length - 1; i++) {
        if (!Form.prototype._controlInput(
                // Returns the value of 'data-type' attribute from the input.
                inputs[i].getAttribute('data-type'),
                // If value is '', return 0, else return the value contains in the input.
                (inputs[i].value != '') ? inputs[i].value : 0
            )) {
            break;
        }
    }
};

/**
 * Prevents the default behaviour about forms.
 *
 * @private
 */
Form.prototype._preventSubmit = function() {
    document.getElementById(this.id).submit = function() {
        return false;
    }
};

/**s
 * Disables a button.
 *
 * @private
 */
Form.prototype.disabledButton = function() {
    document.getElementById(this.submitButton).setAttribute('disabled', 'disabled');
};

/**
 * Controls all content of the form (not the token generated by Symfony)..
 */
Form.prototype._events = function() {
    let formId = this.form.getAttribute('id');
    let inputs = this.form.getElementsByTagName('input');
    let buttons = this.buttons;

    // Disables the "submit" button.
    this.disabledButton();

    // Sets for all inputs an event.
    let j;
    for (j = 0; j < inputs.length - 1; j++) {
        inputs[j].addEventListener('change', this._controlForm);
    }

    // Sets for buttons an event passed in parameter in constructor (array)
    let k;
    for (k = 0; k < buttons.length; k++) {
        document.getElementById(buttons[k]).addEventListener('click', function() {
            document.getElementById(formId).reset();
        });
    }
};